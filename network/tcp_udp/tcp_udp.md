# TCP, UDP

네트워크의 계층들 중 전송 계층에 해당합니다. 전송계층은 송신자와 수신자를 연결하는 통신서비스를 제공하는 계층으로, 쉽게 말해 데이터의 전달을 담당합니다.  이런 **데이터를 보내기 위해 사용하는 프로토콜**이 TCP와 UDP입니다. 

![layer](../images/tcp_udp/layer.jpeg)



## TCP(Transmission Control Protocol)

TCP는 인터넷상에서 데이터를 메시지의 형태로 보내기 위해 IP와 함께 사용하는 프로토콜 입니다. IP가 데이터의 배달을 처리한다면 TCP는 패킷을 추적하고 관리하게 됩니다. 

![TCP](../images/tcp_udp/TCP.png)



### 특징

- 연결 지향 방식으로 패킷 교환 방식을 사용합니다. (가상회선 방식이 아님)
- 3-way handshaking 과정을 통해 연결을 설정하고 4-way handshaking 을 통해 해제합니다. 
- 흐름 제어 및 혼잡 제어 
- 높은 신뢰성을 보장합니다. 
- UDP보다 속도가 느립니다. 
- 전이중(Full-Duplex), 점대점(Point to Point) 방식



TCP가 연결 지향 방식이라는 것은 패킷을 전송하기 위한 논리적인 경로를 배정한다는 말입니다. 패킷들은 이 경로를 통해 전달됩니다. 

3-way handshaking 과정은 목적지와 수신지를 확실히 하여(데이터 전달을 시작하기 전 먼저 서로 몇가지 패킷을 보내며 확인) 정확한 전송을 보장하기 위해 세션을 수립하는 과정을 의미합니다. 

데이터 흐름 제어, 혼잡도 제어와 같은 기능들을 하여 신뢰성을 보장하지만 이러한 기능들은 CPU를 사용하고 속도에 영향을 주기에 TCP는 UDP보다 속도가 느립니다. 따라서 TCP는 연속성보다 신뢰성있는 전송이 중요할 때 사용하는 프로토콜로 파일 전송 같은 경우에 사용됩니다. 



### 헤더

TCP는 상위계층으로부터 데이터를 받아 헤더를 추가하여 IP로 전송합니다. 

![TCP_header](../images/tcp_udp/TCP_header.png)

| 필드                          | 내용                                                         | 크기(bits) |
| ----------------------------- | ------------------------------------------------------------ | ---------- |
| Source Port, Destination Port | TCP로 연결되는 가상 회선 양단의 송수신 프로세스에 할당되는 포트 주소 | 16         |
| Sequence Number               | 송신자가 지정하는 순서 번호, **전송되는 바이트 수** 기준으로 증가 SYN = 1 : 초기 시퀀스 번호. ACK 번호는 이 값에 + 1 | 32         |
| Acknowledgment(ACK) Number    | 수신 프로세스가 제대로 **수신한 바이트의 수** 응답 용        | 32         |
| Header Length(Data Offset)    | TCP 헤더 길이를 4바이트 단위로 표시(최소 20, 최대 60 바이트) | 4          |
| Resv(Reserved)                | 나중을 위해 0으로 채워진 예약 필드                           | 6          |
| Flag Bit                      | SYN, ACK, FIN 등 제어 번호(아래 표 참고)                     | 6          |
| Window Size                   | **수신 윈도우의 버퍼 크기** 지정(0이면 송신 중지). 상대방의 확인 없이 전송 가능한 최대 바이트 수 | 16         |
| TCP Checksum                  | 헤더와 데이터의 에러 확인 용도                               | 16         |
| Urgent Pointer(긴급 위치)     | 현재 순서 번호부터 표시된 바이트까지 긴급한 데이터임을 표시, URG 플래그 비트가 지정된 경우에만 유효 | 16         |
| Options                       | 추가 옵션 있을 경우 표시                                     | 0~40       |



Flag bit

| 종류 | 내용                                                         |
| ---- | ------------------------------------------------------------ |
| URG  | 긴급 위치 필드 유효 여부 설정                                |
| ACK  | 응답 유효 여부 설정. 최초의 SYN 패킷 이후 모든 패킷은 ACK 플래그 설정 필요. 데이터를 잘 받았으면 긍정 응답으로 ACK(=SYN+1) 전송 |
| PSH  | 수신측에 버퍼링된 데이터를 상위 계층에 즉시 전달할 때        |
| RST  | 연결 리셋 응답 혹은 유효하지 않은 세그먼트 응답              |
| SYN  | 연결 설정 요청. 양쪽이 보낸 최초 패킷에만 SYN 플래그 설정    |
| FIN  | 연결 종료 의사 표시                                          |





*패킷(Packet) 이란?*

인터넷 내에서 데이터를 보내기 위한 경로배정(라우팅)을 효율적으로 하기 위해서 데이터를 여러 개의 조각으로 나누어 전송하는데 이 조각을 패킷이라고 합니다. 



*TCP가 패킷을 추적 관리하는 방법?*

데이터는 패킷단위로 나누어 같은 목적지(IP계층)로 전송됩니다. 만약 데이터 A, B, C가 있다고 했을 때 이 패킷들이 From에서 출발하여 To로 순서대로 가야 하는 상황이라고 가정하겠습니다. 이때 A, B, C라는 패킷에 번호를 부여하여 패킷의 분실이나 순서를 통해 목적지에서 재조립을 합니다. 이런 방식으로 TCP는 패킷을 추적하며, 나누어 보내진 데이터를 받고 조립할 수 있습니다. 



*흐름제어(Flow Control), 혼잡제어(Congestion Control) 이란?*

흐름제어는 데이터를 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지하는 것입니다. 예를 들면 송신하는 곳에서 감당이 안되게 데이터를 빠르게 많이 보내면 수신자에게 계속 쌓이고 결국 문제가 발생합니다. 

혼잡제어는 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 방지하는 것입니다. 만약 정보의 소통량이 과다하면 패킷을 조금만 전송하여 혼잡 붕괴 현상이 일어나는 것을 막습니다. 



## UDP(User Datagram Protocol)

UDP는 데이터를 데이터그램 단위로 처리하는 프로토콜입니다. 데이터그램이란 독립적인 관계를 지니는 패킷입니다. UDP는 TCP와는 달리 비연결형 프로토콜입니다. 연결을 위해 할당되는 논리적인 경로가 없습니다. 따라서 각각의 패킷은 다른 경로로 전송되고, 각각의 패킷은 독립적인 관계를 지니게 됩니다. 



![UDP](../images/tcp_udp/UDP.png)



### 특징

- 비연결형 서비스로 데이터그램 방식을 제공합니다. 
- 정보를 주고 받을 때 정보를 보내거나 받는다는 신호절차를 거치지 않습니다. 
- UDP 헤더의 CheckSum 필드를 통해 최소한의 오류만 검출합니다. 
- 신뢰성이 낮습니다. 
- TCP보다 속도가 빠릅니다.



UDP는 비연결형 서비스이기 때문에, 연결을 설정하고 해제하는 과정이 존재하지 않습니다. 또한 서로 다른 경로로 독립적으로 처리함에도 패킷에 순서를 부여하여 재조립을 하거나 흐름 제어 또는 혼잡 제어와 같은 기능도 처리하지 않기에 TCP 보다 속도가 빠르며 네트워크 부하가 적다는 장점이 있지만 신뢰성있는 데이터의 전송을 보장하지 못합니다. 따라서 신뢰성보다는 연속성이 중요한 서비스, 예를 들면 실시간 서비스(streaming)에 자주 사용됩니다. 



### 헤더

![UDP_header](../images/tcp_udp/UDP_header.png)

| 필드                          | 내용                                                         | 크기(bits) |
| ----------------------------- | ------------------------------------------------------------ | ---------- |
| Source Port, Destination Port | 송수신 애플리케이션의 포트 번호                              | 16         |
| Length                        | 헤더와 데이터 포함 전체 길이                                 | 16         |
| Checksum                      | 헤더와 데이터의 에러 확인 용도. UDP는 에러 복구를 위한 필드가 불필요하기 때문에 TCP 헤더에 비해 간단 | 16         |



마지막으로 다음은 TCP와 UDP의 특징을 간단하게 비교한 표입니다. 

![TCP_UDP비교](../images/tcp_udp/TCP_UDP비교.png)





참고

[MangKyu](https://mangkyu.tistory.com/15)

